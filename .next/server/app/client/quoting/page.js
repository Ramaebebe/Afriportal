(()=>{var e={};e.id=563,e.ids=[563],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},51357:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>d,pages:()=>m,routeModule:()=>h,tree:()=>c}),s(74701),s(5179),s(53733),s(59198);var a=s(30170),r=s(45002),n=s(83876),i=s.n(n),l=s(66299),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["client",{children:["quoting",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,74701)),"C:\\Users\\TebohoRamaebebe\\OneDrive - Afrirent PTY Ltd\\Documents\\GitHub\\portal2509-ssrfix2\\src\\app\\client\\quoting\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,5179)),"C:\\Users\\TebohoRamaebebe\\OneDrive - Afrirent PTY Ltd\\Documents\\GitHub\\portal2509-ssrfix2\\src\\app\\client\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,53733)),"C:\\Users\\TebohoRamaebebe\\OneDrive - Afrirent PTY Ltd\\Documents\\GitHub\\portal2509-ssrfix2\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,59198)),"C:\\Users\\TebohoRamaebebe\\OneDrive - Afrirent PTY Ltd\\Documents\\GitHub\\portal2509-ssrfix2\\src\\app\\not-found.tsx"]}],m=["C:\\Users\\TebohoRamaebebe\\OneDrive - Afrirent PTY Ltd\\Documents\\GitHub\\portal2509-ssrfix2\\src\\app\\client\\quoting\\page.tsx"],d="/client/quoting/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/client/quoting/page",pathname:"/client/quoting",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},63298:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,63642,23)),Promise.resolve().then(s.t.bind(s,87586,23)),Promise.resolve().then(s.t.bind(s,47838,23)),Promise.resolve().then(s.t.bind(s,58057,23)),Promise.resolve().then(s.t.bind(s,77741,23)),Promise.resolve().then(s.t.bind(s,13118,23))},59232:(e,t,s)=>{Promise.resolve().then(s.bind(s,95949))},75421:()=>{},2485:(e,t,s)=>{Promise.resolve().then(s.bind(s,39399)),Promise.resolve().then(s.bind(s,39432)),Promise.resolve().then(s.bind(s,68337))},35303:()=>{},95949:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(97247),r=s(28964);async function n(e,t,s){let a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),...s});if(!a.ok)throw Error(await a.text()||`Request failed: ${a.status}`);return a.json()}function i(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)({mmCode:"",termMonths:36,residualPct:25,rateApr:12.5,mileageKmPerMonth:5e3,maintenanceRpm:450,tyresRpm:180,insuranceRpm:350,adminRpm:99,riskGrade:"B",excessCpkCents:15}),[l,o]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),x=(0,r.useMemo)(()=>e.find(e=>e.mmCode===s.mmCode),[e,s.mmCode]),b=async()=>{if(p(null),o(null),m(null),x)try{let e=await n("/api/quotes/price",{...s,capex:x.capex});o(e)}catch(e){p(e.message??"Failed to calculate quote")}},v=async()=>{if(x&&l){p(null),u(!0),m(null);try{let e={quoteId:`Q-${Date.now()}`,customer:{name:"Afrirent Client",email:"client@example.com",costCenter:"Default"},vehicle:{mmCode:x.mmCode,make:x.make,model:x.model,derivative:x.derivative},term:{months:s.termMonths,km:Math.round(s.mileageKmPerMonth*s.termMonths)},accessories:[...s.maintenanceRpm?[{label:"Maintenance plan (pm)",price:s.maintenanceRpm}]:[],...s.tyresRpm?[{label:"Tyres (pm)",price:s.tyresRpm}]:[],...s.insuranceRpm?[{label:"Insurance (pm)",price:s.insuranceRpm}]:[],...s.adminRpm?[{label:"Admin (pm)",price:s.adminRpm}]:[]],pricing:{baseCapex:x.capex,residualPct:s.residualPct,aprPct:s.rateApr,monthlyPayment:l.monthlyPayment,totalCost:l.totalCost,options:[{label:"Option 1 (36/180k)",monthlyPayment:l.monthlyPayment,totalCost:l.totalCost},{label:"Option 2 (48/200k)",monthlyPayment:Math.round(.92*l.monthlyPayment),totalCost:Math.round(1.22*l.totalCost)},{label:"Option 3 (60/200k)",monthlyPayment:Math.round(.85*l.monthlyPayment),totalCost:Math.round(1.45*l.totalCost)}],evAlternative:{label:"EV Alternative",monthlyPayment:Math.round(1.08*l.monthlyPayment),totalCost:Math.round(1.12*l.totalCost)}},store:!0,returnSignedUrl:!0},t=await n("/api/quotes/pdf",e);if(t.error)throw Error(t.error);if(t.pdfUrl)m(t.pdfUrl);else if(t.path){let e=await n("/api/storage/signed-url",{bucket:"signed-quotes",path:t.path,expiresIn:3600});m(e.url)}else throw Error("PDF generated but no URL returned")}catch(e){p(e.message??"Failed to generate PDF")}finally{u(!1)}}};return(0,a.jsxs)("div",{className:"container-tight",children:[(0,a.jsxs)("div",{className:"card p-4 mb-4",children:[a.jsx("h1",{className:"text-xl font-semibold mb-2",children:"Create Quote"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Vehicle"}),(0,a.jsxs)("select",{className:"input",value:s.mmCode,onChange:e=>i(t=>({...t,mmCode:e.target.value})),children:[a.jsx("option",{value:"",children:"Select..."}),e.map(e=>(0,a.jsxs)("option",{value:e.mmCode,children:[e.make," ",e.model," ",e.derivative," — MM ",e.mmCode," — R",e.capex.toLocaleString()]},e.mmCode))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Term (months)"}),a.jsx("input",{className:"input",type:"number",value:s.termMonths,onChange:e=>i(t=>({...t,termMonths:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Residual (%)"}),a.jsx("input",{className:"input",type:"number",value:s.residualPct,onChange:e=>i(t=>({...t,residualPct:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"APR (%)"}),a.jsx("input",{className:"input",type:"number",value:s.rateApr,onChange:e=>i(t=>({...t,rateApr:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Mileage (km/mo)"}),a.jsx("input",{className:"input",type:"number",value:Math.round(s.mileageKmPerMonth),onChange:e=>i(t=>({...t,mileageKmPerMonth:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Maintenance (R/pm)"}),a.jsx("input",{className:"input",type:"number",value:s.maintenanceRpm,onChange:e=>i(t=>({...t,maintenanceRpm:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Tyres (R/pm)"}),a.jsx("input",{className:"input",type:"number",value:s.tyresRpm,onChange:e=>i(t=>({...t,tyresRpm:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Insurance (R/pm)"}),a.jsx("input",{className:"input",type:"number",value:s.insuranceRpm,onChange:e=>i(t=>({...t,insuranceRpm:Number(e.target.value||0)}))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Admin (R/pm)"}),a.jsx("input",{className:"input",type:"number",value:s.adminRpm,onChange:e=>i(t=>({...t,adminRpm:Number(e.target.value||0)}))})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex gap-3",children:[a.jsx("button",{className:"btn",onClick:b,disabled:!x,children:"Calculate"}),a.jsx("button",{className:"btn",onClick:v,disabled:!x||!l||d,children:d?"Generating PDF...":"Generate PDF"})]}),h&&a.jsx("p",{className:"mt-3 text-red-400 text-sm",children:h})]}),l&&(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"kpi",children:[a.jsx("div",{className:"text-sm text-white/70",children:"Monthly Payment"}),(0,a.jsxs)("div",{className:"text-2xl font-semibold",children:["R ",l.monthlyPayment.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"kpi",children:[a.jsx("div",{className:"text-sm text-white/70",children:"Total Cost"}),(0,a.jsxs)("div",{className:"text-2xl font-semibold",children:["R ",l.totalCost.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"kpi",children:[a.jsx("div",{className:"text-sm text-white/70",children:"Residual"}),(0,a.jsxs)("div",{className:"text-2xl font-semibold",children:[s.residualPct,"%"]})]})]}),c&&a.jsx("div",{className:"card p-4 mt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium",children:"Quotation PDF is ready"}),a.jsx("div",{className:"text-sm text-white/70 break-all",children:c})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("a",{href:c,target:"_blank",rel:"noreferrer",className:"btn",children:"Open"}),a.jsx("a",{href:c,download:!0,className:"btn",children:"Download"}),a.jsx("button",{className:"btn",onClick:()=>navigator.clipboard.writeText(c),children:"Copy link"})]})]})})]})}},39399:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var a=s(97247),r=s(28964),n=s(80919);function i({children:e}){let[t,s]=(0,r.useState)(!1);if(!t)return a.jsx("div",{className:"min-h-[60vh] grid place-items-center",children:a.jsx("div",{className:"text-white/70",children:"Checking your session…"})});let i=sessionStorage.getItem("afp.role")||"client_user";return a.jsx(n.rU,{initialRole:i,children:e})}},39432:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var a=s(97247),r=s(79906),n=s(34178),i=s(80919);let l=({href:e,label:t})=>{let s=(0,n.usePathname)()===e;return a.jsx(r.default,{href:e,className:`navlink ${s?"navlink-active":""}`,children:t})},o=()=>{let{role:e}=(0,i.ss)();return(0,a.jsxs)("nav",{className:"card p-3 space-y-1",children:[a.jsx("div",{className:"text-xs uppercase tracking-wider text-white/50 px-2 pb-1",children:"Menu"}),a.jsx(l,{href:"/client/dashboard",label:"Dashboard"}),a.jsx(l,{href:"/client/quoting",label:"Quoting"}),a.jsx(l,{href:"/client/reports",label:"Reports"}),("ops"===e||"admin"===e)&&a.jsx(l,{href:"/client/audits",label:"Vehicle Audits"})]})}},68337:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var a=s(97247),r=s(44597),n=s(78256);let i=()=>{let e=async()=>{await n.supabase.auth.signOut(),window.location.href="/"};return(0,a.jsxs)("header",{className:"card px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx(r.default,{src:"/logo.svg",alt:"Logo",width:32,height:32}),a.jsx("span",{className:"font-semibold",children:"Afrirent Portal"})]}),a.jsx("div",{className:"text-sm text-white/70",children:"Welcome, User"}),a.jsx("button",{className:"navlink",onClick:e,children:"Sign out"})]})}},80919:(e,t,s)=>{"use strict";s.d(t,{rU:()=>i,ss:()=>l});var a=s(97247),r=s(28964);let n=(0,r.createContext)(void 0),i=({initialRole:e="client_user",children:t})=>{let[s,i]=(0,r.useState)(e);return a.jsx(n.Provider,{value:{role:s,setRole:i},children:t})},l=()=>{let e=(0,r.useContext)(n);if(!e)throw Error("useRBAC must be used within RBACProvider");return e}},78256:()=>{},5179:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(72051),r=s(45347);let n=(0,r.createProxy)(String.raw`C:\Users\TebohoRamaebebe\OneDrive - Afrirent PTY Ltd\Documents\GitHub\portal2509-ssrfix2\src\components\Sidebar.tsx#default`),i=(0,r.createProxy)(String.raw`C:\Users\TebohoRamaebebe\OneDrive - Afrirent PTY Ltd\Documents\GitHub\portal2509-ssrfix2\src\components\Topbar.tsx#default`),l=(0,r.createProxy)(String.raw`C:\Users\TebohoRamaebebe\OneDrive - Afrirent PTY Ltd\Documents\GitHub\portal2509-ssrfix2\src\components\ClientGuard.tsx#default`);function o({children:e}){return a.jsx(l,{children:a.jsx("div",{className:"container-tight",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4",children:[a.jsx("aside",{className:"col-span-12 md:col-span-3 lg:col-span-2",children:a.jsx(n,{})}),(0,a.jsxs)("main",{className:"col-span-12 md:col-span-9 lg:col-span-10",children:[a.jsx(i,{}),a.jsx("div",{className:"mt-4",children:e})]})]})})})}},74701:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(45347).createProxy)(String.raw`C:\Users\TebohoRamaebebe\OneDrive - Afrirent PTY Ltd\Documents\GitHub\portal2509-ssrfix2\src\app\client\quoting\page.tsx#default`)},53733:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>r});var a=s(72051);s(5023);let r={title:"Afrirent Portal",description:"Client analytics & quoting suite"};function n({children:e}){return a.jsx("html",{lang:"en",children:(0,a.jsxs)("body",{children:[e,a.jsx("footer",{className:"mt-28 footer-strip",children:(0,a.jsxs)("div",{className:"container-tight flex items-center justify-between py-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("img",{src:"/brand/afrirent_logo.png",alt:"Afrirent",className:"h-8"}),a.jsx("span",{className:"opacity-90 text-sm",children:"A partner on your journey"})]}),a.jsx("span",{className:"text-sm opacity-90",children:"\xa9 2025 Afrirent Mobility"})]})})]})})}},59198:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(72051);function r(){return a.jsx("main",{className:"container-tight py-24",children:(0,a.jsxs)("div",{className:"card p-10 text-center",children:[a.jsx("h1",{className:"text-4xl font-bold mb-2",children:"404"}),a.jsx("p",{className:"text-white/70 mb-6",children:"Sorry, the page you’re looking for was not found."}),a.jsx("a",{className:"btn inline-block",href:"/",children:"Go back home"})]})})}},5023:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[787,398,80,789],()=>s(51357));module.exports=a})();